# ì˜ì–´ìŠ¤í„°ë”” ì‹œì¦Œ 5 1ì£¼ì°¨

created by [juho](https://github.com/pachuho/Development-English-study) on 2022-01-16

https://developer.android.com/guide/playcore/in-app-updates
https://developer.android.com/guide/playcore/in-app-updates/kotlin-java

# ğŸ“— ë‹¨ì–´ ì •ë¦¬ ğŸ“˜

### OBS BUILD
|ì˜ì–´|í•œê¸€|
|---|---|
|up to date|ìµœì‹ ì˜|
|unmetered|ë¬´ì œí•œ|
|rolling out|ì¶œì‹œí•˜ë‹¤|
|specify|ì§€ì •í•˜ë‹¤|

------------------------------

# In-app Updates

When your users keep your app up to date on their devices, they can try new features, as well as benefit from performance improvements and bug fixes. 

`ë‹¹ì‹ ì˜ ìœ ì €ë“¤ì´ ê¸°ê¸°ì— ìµœì‹  ì•±ì„ ìœ ì§€í•  ë•Œ ì„±ëŠ¥ í–¥ìƒê³¼ ë²„ê·¸ ìˆ˜ì •ì˜ ì´ì ë¿ë§Œ ì•„ë‹ˆë¼ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`

Although some users enable background updates when their device is connected to an unmetered connection, other users might need to be reminded to install updates.

`í•˜ì§€ë§Œ ëª‡ëª‡ ìœ ì €ë“¤ì€ ë¬´ì œí•œ ì—°ê²°ì´ ë  ë•Œ ë°±ê·¸ë¼ìš´ë“œ ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•œ ìœ ì €ê°€ ìˆê³  ì„¤ì¹˜ ì—…ë°ì´íŠ¸ ì•Œë¦¼ì„ í•„ìš”ë¡œí•˜ëŠ” ìœ ì €ë“¤ë„ ìˆìŠµë‹ˆë‹¤.`

In-app updates is a Play Core library feature that prompts active users to update your app.

`ì¸ì•± ì—…ë°ì´íŠ¸ëŠ” ì•± ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©ìì—ê²Œ ë©”ì„¸ì§€ë¥¼ ë³´ì—¬ì£¼ëŠ” í”Œë ˆì´ ì½”ì–´ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.`

The in-app updates feature is supported on devices running Android 5.0 (API level 21) or higher, and requires your app to use Play Core library version 1.5.0 or higher. 

`ì¸ì•± ì—…ë°ì´íŠ¸ëŠ” api 21 ì´ìƒì—ì„œ ì§€ì›ë˜ë©° í”Œë ˆì´ìŠ¤í† ì–´ ë²„ì „ 1.5.0 ì´ìƒì„ ìš”êµ¬í•©ë‹ˆë‹¤.`

Additionally, in-app updates are only supported for Android mobile devices, Android tablets, and Chrome OS devices.

`ì¶”ê°€ë¡œ ì¸ì•± ì—…ë°ì´íŠ¸ëŠ” ì˜¤ì§ ì•ˆë“œë¡œì´ë“œ ë””ë°”ì´ìŠ¤, í…Œë¸”ë¦¿ ê·¸ë¦¬ê³  í¬ë¡¬ os ë””ë°”ì´ìŠ¤ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.`

# Update flows

Your app can use the Play Core library to support the following UX flows for in-app updates:

`ì¸ì•± ì—…ë°ì´íŠ¸ëŠ” ë‹¤ìŒê³¼ ê°™ì€ UX í”Œë¡œìš°ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.`

### Flexible updates

![img.png](img.png)

Flexible updates provide background download and installation with graceful state monitoring. 

`ìœ ì—°í•œ ì—…ë°ì´íŠ¸ëŠ” í›Œë¥­í•œ ìƒíƒœ ëª¨ë‹ˆí„°ë§ê³¼ í•¨ê»˜ ë°±ê·¸ë¼ìš´ë“œ ë‹¤ìš´ë¡œë“œì™€ ì„¤ì¹˜ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.`

This UX flow is appropriate when it's acceptable for the user to use the app while downloading the update. 

`ì´ UXí”Œë¡œìš°ëŠ” ì‚¬ìš©ìê°€ ì—…ë°ì´íŠ¸ë¥¼ í•˜ëŠ”ë™ì•ˆ ìœ ì €ê°€ ì•±ì„ ì‚¬ìš©í•  ë•Œ ì í•©í•©ë‹ˆë‹¤.`

For example, you might want to encourage users to try a new feature that's not critical to the core functionality of your app.

`ì˜ˆë¥¼ë“¤ì–´, ë‹¹ì‹ ì´ ìœ ì €ì—ê²Œ ë‹¹ì‹ ì˜ ì•±ì´ í•µì‹¬ ê¸°ëŠ¥ì ìœ¼ë¡œ ì¹˜ëª…ì ì´ì§€ ì•Šì€ ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ë¥¼ ê¶Œì¥í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.`

### Immediate updates

![img_1.png](img_1.png)

Immediate updates are fullscreen UX flows that require the user to update and restart the app in order to continue using it. 

`ì¦‰ì‹œ ì—…ë°ì´íŠ¸ëŠ” ì „ì²´í™”ë©´ UXí”Œë¡œìš°ë¡œ ì•±ì„ ì‚¬ìš©í•˜ê¸°ìœ„í•´ ì‚¬ìš©ìì—ê²Œ ì•±ì„ ì—…ë°ì´íŠ¸í•˜ê³  ì¬ì‹œì‘í•˜ëŠ” ê²ƒì„ ìš”êµ¬í•©ë‹ˆë‹¤.`

This UX flow is best for cases where an update is critical to the core functionality of your app.

`ì´ UXí”Œë¡œìš°ëŠ” ë‹¹ì‹ ì˜ ì•±ì´ í•µì‹¬ ê¸°ëŠ¥ì ìœ¼ë¡œ ì¹˜ëª…ì ì¸ ì—…ë°ì´íŠ¸ê°€ í•„ìš”í•  ë•Œ ìµœì„ ì…ë‹ˆë‹¤.`

After a user accepts an immediate update, Google Play handles the update installation and app restart.

`ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜ë½í•˜ë©´ êµ¬ê¸€ í”Œë ˆì´ëŠ” ì—…ë°ì´íŠ¸ì™€ ì¬ì‹œì‘ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.`

### Check for update availability

Before requesting an update, check if there is an update available for your app. Use AppUpdateManager to check for an update:

`ì—…ë°ì´íŠ¸ë¥¼ ìš”êµ¬í•˜ê¸°ì „ì— ì•± ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•œì§€ ì²´í¬í•©ë‹ˆë‹¤. ì—…ë°ì´íŠ¸ë¥¼ ì²´í¬í•˜ê¸°ìœ„í•´ AppUpdateManagerë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.`

```
val appUpdateManager = AppUpdateManagerFactory.create(context)

// Returns an intent object that you use to check for an update.
val appUpdateInfoTask = appUpdateManager.appUpdateInfo

// Checks that the platform will allow the specified type of update.
appUpdateInfoTask.addOnSuccessListener { appUpdateInfo ->
    if (appUpdateInfo.updateAvailability() == UpdateAvailability.UPDATE_AVAILABLE
        // This example applies an immediate update. To apply a flexible update
        // instead, pass in AppUpdateType.FLEXIBLE
        && appUpdateInfo.isUpdateTypeAllowed(AppUpdateType.IMMEDIATE)
    ) {
        // Request the update.
    }
}
```

The returned AppUpdateInfo instance contains the update availability status. Depending on the status of the update, the instance also contains the following:

`ë¦¬í„´ëœ ì•±ì—…ë°ì´íŠ¸ì¸í¬ ì¸ìŠ¤í„´ìŠ¤ëŠ” ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•œ ìƒíƒœë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì—…ë°ì´íŠ¸ ìƒí…Œì— ë”°ë¼ì„œ ê°ì²´ëŠ” ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤.`

- If an update is available and the update is allowed, the instance also contains an intent to start the update.

`ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë‹¤ë©´ ê°ì²´ëŠ” ì—…ë°ì´íŠ¸ ì‹œì‘ì„ ìœ„í•œ ì¸í…íŠ¸ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.`

- If an in-app update is already in progress, the instance also reports the status of the in-progress update.

`ì¸ì•± ì—…ë°ì´íŠ¸ê°€ ì´ë¯¸ ì§„í–‰ì¤‘ì´ë¼ë©´ ê°ì²´ëŠ” ì—…ë°ì´íŠ¸ ê³¼ì •ì˜ ìƒíƒœë¥¼ ë³´ê³ í•©ë‹ˆë‹¤.`

### Check update priority

The Google Play Developer API allows you to set the priority of each update. This allows your app to decide how strongly to recommend an update to the user. 

`êµ¬ê¸€ í”Œë ˆì´ ê°œë°œì apiëŠ” ë‹¹ì‹ ì´ ê°ê°ì˜ ì—…ë°ì´íŠ¸ì˜ ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•˜ëŠ”ê±¸ ê°€ëŠ¥í•˜ê²Œí•©ë‹ˆë‹¤. ì´ í—ˆìš©ì€ ìœ ì €ì—ê²Œ ì—…ë°ì´íŠ¸ë¥¼ ê¶Œì¥í•˜ëŠ” ê°•ë„ë¥¼ ê²°ì •í•©ë‹ˆë‹¤.`

For example, consider the following strategy for setting update priority:

`ì˜ˆë¥¼ë“¤ì–´ ë‹¤ìŒê³¼ ê°™ì´ ìš°ì„ ìˆœìœ„ë¥¼ ì„¸íŒ…í•˜ë©´`

- Minor UI improvements: Low-priority update; request neither a flexible update nor an immediate update. Update only when the user isn't interacting with your app.

`í•˜ìœ„ UI í–¥ìƒ : ë‚®ì€ ìš°ì„ ìˆ˜ìœ„ ì—…ë°ì´íŠ¸; ìœ ì—°í•œ ì—…ë°ì´íŠ¸ë‚˜ ì¦‰ê°ì ì¸ ì—…ë°ì´íŠ¸ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤. ìœ ì €ì•±ê³¼ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•Šì„ë•Œë§Œ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.`

- Performance improvements: Medium-priority update; request a flexible update.

`í–¥ìƒëœ ì„±ëŠ¥: ì¤‘ê°„ ìˆœìœ„ ì—…ë°ì´íŠ¸; ìœ ì—°í•œ ì—…ë°ì´íŠ¸ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.`

- Critical security update: High-priority update; request an immediate update.

`ì¹˜ëª…ì ì¸ ë³´ì•ˆ ì—…ë°ì´íŠ¸: ë†’ì€ ì—…ë°ì´íŠ¸; ì¦‰ê° ì—…ë°ì´íŠ¸ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.`

To determine priority, Google Play uses an integer value between 0 and 5, with 0 being the default and 5 being the highest priority. 

`ìš°ì„ ìˆœìœ„ë¥¼ ê²°ì •í•˜ê¸°ìœ„í•´ êµ¬ê¸€ í”Œë ˆì´ëŠ” ìˆ«ì 0ë¶€í„° 5ê¹Œì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 0ì´ ê¸°ë³¸ì´ë©° 5ëŠ” ë†’ì€ ìš°ì„ ìˆœìœ„ì…ë‹ˆë‹¤.`

To set the priority for an update, use the inAppUpdatePriority field under Edits.tracks.releases in the Google Play Developer API. 

`ì—…ë°ì´íŠ¸ ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ Editsí•„ë“œì— inAppUpdatePriorityë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. oogle Play Developer APIì— ìˆìŠµë‹ˆë‹¤.`

All newly-added versions in the release are considered to be the same priority as the release. 

`ëª¨ë“  ìƒˆë¡œìš´ ë²„ì „ì€ ë¦´ë¦¬ì¦ˆë¡œì¨ ê°™ì€ ìš°ì„ ìˆœìœ„ê°€ ì„¤ì •ë©ë‹ˆë‹¤.`

Priority can only be set when rolling out a new release and cannot be changed later.

`ìš°ì„ ìˆœìœ„ëŠ” ìƒˆ ì¶œì‹œë¥¼ í•  ë•Œë§Œ ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©° ì¶”í›„ì— ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`

Set the priority using the Google Play Developer API as described in the Play Developer API documentation. 

`ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œëŠ” Play Developer API ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.`

In-app update priority should be specified in the Edit.tracks resource passed in the Edit.tracks: update method. 

`ì¸ì•± ì—…ë°ì´íŠ¸ëŠ” Edit.tracks update methodì—ì„œ ì „ë‹¬ëœ Edit.tracksì—ì„œ ì§€ì •í•´ì•¼í•©ë‹ˆë‹¤.`

![img_2.png](img_2.png)

The following example demonstrates releasing an app with version code 88 and inAppUpdatePriority 5:

`ë‹¤ìŒì€ ë²„ì „ì´ 88ì½”ë“œì´ê³  ì¸ì•±ì—…ë°ì´íŠ¸ìˆœìœ„ê°€  5ì¸ ì˜ˆì œì…ë‹ˆë‹¤. `

```
{
  "releases": [{
      "versionCodes": ["88"],
      "inAppUpdatePriority": 5,
      "status": "completed"
  }]
}
```

In your app's code, you can check the priority level for a given update using updatePriority(). 

`ì•± ì½”ë“œì—ì„œ updatePriority()ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš°ì„ ìˆœìœ„ ë ˆë²¨ì„ ì²´í¬í•©ë‹ˆë‹¤.`

The returned priority takes into account the inAppUpdatePriority for all app version codes between the installed version and latest available version.

`ë°˜í™˜ëœ ìš°ì„ ìˆœìœ„ëŠ” ì„¤ì¹˜ëœ ë²„ì „ê³¼ ì‚¬ìš© ê°€ëŠ¥í•œ ìµœì‹  ë²„ì „ ì‚¬ì´ì— ìˆëŠ” ëª¨ë“  ì•± ë²„ì „ ì½”ë“œì˜ inAppUpdatePriorityë¥¼ ê³ ë ¤í•©ë‹ˆë‹¤.`

```
val appUpdateManager = AppUpdateManagerFactory.create(context)

// Returns an intent object that you use to check for an update.
val appUpdateInfoTask = appUpdateManager.appUpdateInfo

// Checks whether the platform allows the specified type of update,
// and checks the update priority.
appUpdateInfoTask.addOnSuccessListener { appUpdateInfo ->
    if (appUpdateInfo.updateAvailability() == UpdateAvailability.UPDATE_AVAILABLE
          && appUpdateInfo.updatePriority() >= 4 /* high priority */
          && appUpdateInfo.isUpdateTypeAllowed(AppUpdateType.IMMEDIATE)) {
              // Request an immediate update.
    }
}
```

### Start an update

After you confirm that an update is available, you can request an update using AppUpdateManager.startUpdateFlowForResult():

`ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•œì§€ í™•ì¸í•œ í›„ AppUpdateManager.startUpdateFlowForResult()ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—…ë°ì´íŠ¸ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.`

```
appUpdateManager.startUpdateFlowForResult(
    // Pass the intent that is returned by 'getAppUpdateInfo()'.
    appUpdateInfo,
    // Or 'AppUpdateType.FLEXIBLE' for flexible updates.
    AppUpdateType.IMMEDIATE,
    // The current activity making the update request.
    this,
    // Include a request code to later monitor this update request.
    MY_REQUEST_CODE)
```

Each AppUpdateInfo instance can be used to start an update only once. 

`ê°ê°ì˜ AppUpdateInfo ì¸ìŠ¤í„´ìŠ¤ëŠ” í•œë²ˆë§Œ ì‹œì‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`

To retry the update in case of failure, request a new AppUpdateInfo and check again that the update is available and allowed.

`ì—…ë°ì•„íŠ¸ë¥¼ ì‹¤íŒ¨í•œ ê²½ìš° ìƒˆë¡œìš´ AppUpdateInfoë¥¼ ìš”ì²­í•˜ê³  ì—…ë°ì´íŠ¸ ê°€ëŠ¥ ë° í—ˆìš©ì„ í™•ì¸í•©ë‹ˆë‹¤.`

The next steps depend on whether you are requesting a flexible update or an immediate update.

`ê·¸ ë‹¤ìŒ ë‹¨ê³„ëŠ” ìœ ì—° ì—…ë°ì´íŠ¸ì™€ ì¦‰ê° ì—…ë°ì´íŠ¸ë¥¼ ìš”êµ¬í•˜ëŠ”ì§€ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤.`

### Get a callback for update status

After starting an update, you can use an onActivityResult() callback to handle an update failure or cancellation:

`ì—…ë°ì´íŠ¸ë¥¼ ì‹œì‘í•˜ê¸°ìœ„í•´ onActivityResult() ì½œë°±ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. `

```
override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
    if (requestCode == MY_REQUEST_CODE) {
        if (resultCode != RESULT_OK) {
            Log.e("MY_APP", "Update flow failed! Result code: $resultCode")
            // If the update is cancelled or fails,
            // you can request to start the update again.
        }
    }
}
```

![img_3.png](img_3.png)