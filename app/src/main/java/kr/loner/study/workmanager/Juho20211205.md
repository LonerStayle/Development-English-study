# ì˜ì–´ìŠ¤í„°ë”” ì‹œì¦Œ 4 7ì£¼ì°¨

created by [juho](https://github.com/pachuho/Development-English-study) on 2021-12-05

#Android WorkManager

[ì˜ìƒ](https://www.youtube.com/watch?v=_SQM-10TB4k)

# ğŸ“— ë‹¨ì–´ ì •ë¦¬ ğŸ“˜

### OBS BUILD
|ì˜ì–´|í•œê¸€|
|---|---|
|evenly|ê³ ë¥´ê²Œ|
|deferrable|ì—°ê¸°í•  ìˆ˜ ìˆëŠ”|

### Summary

- WorkManager ê°œìš”
- WorkManagerì˜ ì£¼ìš” ê¸°ëŠ¥
- WorkManagerì˜ êµ¬ì„± 
- WorkManagerì˜ ì‚¬ìš© ì˜ˆì‹œ

------------------------------

## WorkManager ê°œìš”
![img.png](img.png)
- ì•±ì´ ì¢…ë£Œë˜ê±°ë‚˜ ê¸°ê¸°ê°€ ë‹¤ì‹œ ì‹œì‘ë˜ì–´ë„ ì‹¤í–‰ ì˜ˆì •ì¸ ì§€ì—° ê°€ëŠ¥í•œ ë¹„ë™ê¸° ì‘ì—…ì„ ì‰½ê²Œ ì˜ˆì•½í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.
- ì•ˆë“œë¡œì´ë“œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ, Android Jetpack ì•„í‚¤í…ì²˜ì˜ êµ¬ì„± ìš”ì†Œ ì¤‘ í•˜ë‚˜ì´ë‹¤.
- í•˜ë‚˜ì˜ ì½”ë“œë¡œ API Level ë§ˆë‹¤ ë¹„ìŠ·í•œ ë™ì‘ì„ ë³´ì¥í•œë‹¤.

## WorkManagerì˜ ì£¼ìš” ê¸°ëŠ¥

- API 14 ì´ìƒ ë‹¨ë§ì„ ì§€ì›í•œë‹¤.
- ë„¤íŠ¸ì›Œí¬ ê°€ìš©ì„±, ì¶©ì „ìƒíƒœì™€ ê°™ì€ ì‘ì—…ì˜ ì œì•½ ì¡°ê±´ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.
- ì¼íšŒì„± í˜¹ì€ ì£¼ê¸°ì ì¸ ë¹„ë™ê¸° ì‘ì—…ì„ ì˜ˆì•½í•  ìˆ˜ ìˆë‹¤.
- ì˜ˆì•½ëœ ì‘ì—… ëª¨ë‹ˆí„°ë§ ê´€ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
- ì•±ì´ë‚˜ ê¸°ê¸°ë‚˜ ë‹¤ì‹œ ì‹œì‘ë˜ëŠ” ê²½ìš°ì—ë„ ì‘ì—… ì‹¤í–‰ì„ ë³´ì¥í•œë‹¤.
- ì ìê¸° ëª¨ë“œì™€ ê°™ì€ ì ˆì „ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.
- ì§€ì—° ê°€ëŠ¥í•˜ê³  ì•ˆì •ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ” ì‘ì—…ì„ ëŒ€ìƒìœ¼ë¡œ ì„¤ê³„ë˜ì–´ ìˆë‹¤. (ex. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì— ë¡œê·¸ ë˜ëŠ” ë¶„ì„ì„ ì „ì†¡í•˜ëŠ” ì‘ì—…, ì£¼ê¸°ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì„œë²„ì™€ ë™ê¸°í™”í•˜ëŠ” ì‘ì—…)

## WorkManagerì˜ êµ¬ì„±
![img_1.png](img_1.png)

### 1. WorkManager
- ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ì‘ì—…ì„ ìì‹ ì˜ íì— ë„£ê³  ê´€ë¦¬í•œë‹¤.
- ì‹±ê¸€í†¤ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆì–´ì„œ getInstance()ë¡œ WorkManagerì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°›ì•„ ì‚¬ìš©í•œë‹¤.
### 2. Worker
- ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ì˜ ì²˜ë¦¬ ì½”ë“œë¥¼ ì´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ doWork() ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ì‘ì„±í•œë‹¤.
- dowork()ëŠ” ì‘ì—… ê²°ê³¼ì— ë”°ë¼ Resultë¥¼ success, failure, retry ë¡œ ë¶„ê¸°ì²˜ë¦¬ í•´í–í•œë‹¤.
### 3. WorkRequest
- WorkManagerë¥¼ í†µí•´ ì‹¤ì œ ìš”ì²­í•˜ê²Œ ë  ê°œë³„ ì‘ì—…ì´ë‹¤.
- ì²˜ë¦¬í•´ì•¼ í•  ì‘ì—…ì¸ Workì™€ ì‘ì—…ë°˜ë³µ ì—¬ë¶€ ë° ì‘ì—…ì‹¤í–‰ ì¡°ê±´, ì œì•½ì‚¬í•­ ë“± ì´ ì‘ì—…ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ì— ëŒ€í•œ ì •ë³´ê°€ ë‹´ê²¨ìˆë‹¤.
- ë°˜ë³µ ì—¬ë¶€ì— ë”°ë¼ onTimeWorkRequest, PeriodicWorkRequestë¡œ ë‚˜ë‰œë‹¤.
### 4. WorkState
- WorkRequestì˜ idì™€ í•´ë‹¹ WorkRequestì˜ í˜„ì¬ ìƒíƒœë¥¼ ë‹´ëŠ” í´ë˜ìŠ¤
- ENQUEUED, RUNNING, SUCCEEDED, FAILED, BLOCKED, CANCELLEDì˜ 6ê°œì˜ ìƒíƒœë¥¼ ê°€ì§„ë‹¤.

## WorkManagerì˜ ì‚¬ìš© ì˜ˆì‹œ
### 1. ë‹¨ìˆœ ì‘ì—…
```
import androidx.work.Worker

class ExampleWorker : Worker() {
    override fun doWork(): Result {
        /* ì²˜ë¦¬í•´ì•¼í•  ì‘ì—…ì— ê´€í•œ ì½”ë“œë“¤ 
       ì²˜ë¦¬ ê²°ê³¼ì— ë”°ë¼ ë¦¬í„´ ê²°ê³¼ë¥¼ ì§€ì •í•´ì¤€ë‹¤.*/
        return Result.success()
    }
}
```
- Worker í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì€ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³  doWork() ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œ í•œë‹¤.
###
```
var workRequest = OneTimeWorkRequestBuilder<ExampleWorker>().build()
```
- OneTimeWorkRequestBuilderë¥¼ ì´ìš©í•´ì„œ OneTimeWorkRequestê°ì²´ë¥¼ ìƒì„±í•œë‹¤
###

```
var workRequest = OneTimeWorkRequestBuilder<ExampleWorker>().build()

val workManager = WorkManager.getInstance()

workManager?.enqueue(workRequest)
```
-  WorkManager í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‘ì—…íì— ì¶”ê°€í•´ì¤€ë‹¤.
###

```
val workReqeust = PeriodicWorkRequestBuilder<ExampleWorker>(15, TimeUnit.MINUTES).build()

val workManager = WorkManager.getInstance()

workManager?.enqueue(workRequest)
```
- ë°˜ë³µë˜ëŠ” ì‘ì—…ì€ PeriodWorkReqeustBuilderë¥¼ ì´ìš©í•´ì¤€ë‹¤.(ë°˜ë³µì‹œê°„ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°€ì¥ ì§§ì€ ìµœì†Œê°’ì€ 15ì´ë‹¤.)
###
### 2. ì œì•½ ì¡°ê±´ì„ ê°€ì§€ëŠ” ì‘ì—…
```
val constraints = Constraints.Builder()
	/* ë„¤íŠ¸ì›Œí¬ ì—°ê²°ìƒíƒœì— ëŒ€í•œ ì œì•½ ì¡°ê±´ */
	.setRequiredNetworkType(NetworkType.CONNECTED)
	/* ì¶©ì „ ìƒíƒœì— ëŒ€í•œ ì œì•½ ì¡°ê±´ */
	.setRequiresCharging(true)
	.build()

/* ì œì•½ì¡°ê±´ê³¼ í•¨ê»˜ ì‘ì—…ì„ ìƒì„±í•˜ê±°ë‚˜ */
val requestConstraint = OneTimeWorkRequestBuilder<ExampleWorker>()
	.setConstraints(constraints)
	.build()

/* ì‘ì—…ì„ ìƒì„±í•˜ê³  ë‚˜ì¤‘ì— ì œì•½ì¡°ê±´ì„ ì„¤ì •í•´ ì¤„ìˆ˜ ìˆë‹¤ */
workRequest.setConstraint(constraints)
```
- ì œì•½ ì¡°ê±´ì€ Constrains í´ë˜ìŠ¤ì˜ Builderë¥¼ ì´ìš©í•´ì„œ ìƒì„±í•œ ë’¤ WorkRequestì— ì¶”ê°€í•œë‹¤.
###
### 3. ì—°ê²°ëœ ì‘ì—…
```
val workA = OneTimeWorkReqeustBuilder<AWorker>().build()
val workB = OneTimeWorkRequestBuider<BWorker>().build()

WorkManager.getInstance()?.apply {
    beginWith(workA).then(workB).enqueue()
}
```
- ë‘ ì‘ì—…ì„ ì—°ê²°í•´ì„œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ beginWith()ì™€ then()ì¸ìë¥¼ ì‚¬ìš©í•´ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
###
### 4. ì‘ì—… ì²˜ë¦¬ìƒíƒœ íŒŒì•…
```
val workRequest = OneTimeWorkRequestBuilder<ExampleWorker>().build()

val workManager = WorkManager.getInstance()
workManager?.let {
    it.enqueue(workRequest)
    
    /** WorkManagerì˜ getStatusById()ì— WorkRequestì˜ UUID ê°ì²´ë¥¼ ì¸ìë¡œ ì „ë‹¬ í•˜ë©´
     *  ì¸ìê°’ìœ¼ë¡œ ì£¼ì–´ì§„ IDì— í•´ë‹¹í•˜ëŠ” ì‘ì—…ì„ ì¶”ì í•  ìˆ˜ ìˆë„ë¡ LiveData ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤
   	 */
    val statusLiveData = it.getStatusById(workRequest.id)
    /* statusLiveDataì— Observerë¥¼ ê±¸ì–´ì„œ ì‘ì—…ì˜ ìƒíƒœë¥¼ ì¶”ì  */
    statusLiveData.observe(this, Observer { workState ->
        Log.d("exmaple", "state: ${workState?.state}")
    })
}
```
- LiveDataë¥¼ í†µí•´ ì˜µì €ë¹™ í•  ìˆ˜ ìˆë‹¤.
###
### 5. ì‘ì—… ì·¨ì†Œ
```
/* cancelWork ì‘ì—…ì„ WorkManagerì˜ íì— ì¶”ê°€ */
WorkManager.getInstance()?.enqueue(cancelWork)

/* cancelWorkì˜ idë¥¼ ì´ìš©í•´ì„œ ì‘ì—…ì„ ì·¨ì†Œ */
WorkManager.getInstnace()?.cancelWorkById(cancelWork.id)
```
- UUIDë¥¼ ì´ìš©í•´ ì‘ì—…ì„ ì·¨ì†Œ ì‹œí‚¨ë‹¤. ì•„ë˜ì™€ ê°™ì´ íƒœê·¸ë¥¼ ì´ìš©í•´ ì‘ì—…ì„ ì·¨ì†Œí•  ìˆ˜ ìˆë‹¤.
```
val cancelWork = OnetimeRequestBuilder<CancelWorker>()
	.addTag("cancel work tag")

WorkManager.getInstnace()?.cancelWorkById("cancel work tag")
```
###
- ì·¨ì†Œí•˜ë ¤ëŠ” ì‘ì—…ì´ ì´ë¯¸ ì™„ë£Œëœ ì‘ì—…ì´ë¼ë©´ ì·¨ì†Œ ë©”ì„œë“œëŠ” ì•„ë¬´ ê¸°ëŠ¥ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì•„ì§ ì‹¤í–‰ ì „ íì— ë‹´ê¸´ ìƒíƒœë¼ë©´ ì‹¤í–‰í•˜ì§€ ì•Šê³  ì·¨ì†Œëœë‹¤.
- ì´ë¯¸ ì‹¤í–‰ëœ ì‘ì—…ì´ë¼ë©´ ì„ì˜ë¡œ ì·¨ì†Œë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ doWork()ì— ì‘ì—… ì·¨ì†Œ í”Œë˜ê·¸ë¥¼ ì„¤ì •í•´ ì¤„ ìˆ˜ ìˆë‹¤.
```
override fun doWork() : Result {
    if (isStopped) {
        /* ì‘ì—…ì´ ë©ˆì¶”ì—ˆì„ ë•Œ ëŒ€ë¹„í•œ ì½”ë“œ */
        
        if (isCancelled) {
            /* ì‘ì—…ì´ ì·¨ì†Œ ë˜ì—ˆì„ ë•Œ ëŒ€ë¹„í•œ ì½”ë“œ */
        }
    }
}
```

