# Improve app performance while profiling ~ Native Memory Profiler ì‹œì‘ì „ê¹Œì§€   
   
## ê°œë…   
   
### 1.ì•±ì—ì„œ ë©”ëª¨ë¦¬ í• ë‹¹ ìƒ˜í”Œ í™•ì¸ì´ ê°€ëŠ¥í•¨   
+ API 26 ì´ìƒì¸ í…ŒìŠ¤íŠ¸ê¸°ê¸° ì—ì„œ Allocation Tracking ë¡œ ë™ì‘ ë°©ì‹ì„ ì„¤ì • í•  ìˆ˜ ìˆìŒ   
   
![Alt text](https://github.com/LonerStayle/Development-English-study/blob/main/app/src/main/res/drawable/loner20210718_select.png)   
   
1) Full :  ë©”ëª¨ë¦¬ì˜ ëª¨ë“  í• ë‹¹ì„ ìº¡ì³ * ì‚¬ìš©ì‹œ ì•±ì´ ëŠë ¤ì§   
   
![Alt text](https://github.com/LonerStayle/Development-English-study/blob/main/app/src/main/res/drawable/loner20210718_full.png)   
   
2) Sampled : ì¼ì •í•œ ê°„ê²©ìœ¼ë¡œ ë©”ëª¨ë¦¬ ê°ì²´ í• ë‹¹ ìƒ˜í”Œì„ ìº¡ì³ * ë””í´íŠ¸ ì„±ëŠ¥, Full ë³´ë‹¨ ì•±ì´ ëœ ëŠë ¤ì§   
   
![Alt text](https://github.com/LonerStayle/Development-English-study/blob/main/app/src/main/res/drawable/loner20210718_sampled.png)   

3) Off: ì¤‘ë‹¨   
   
### 2. JNI ì°¸ì¡° ë³´ê¸°   
+ ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ëŸ¬ì˜ JNI heap ë·°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸€ë¡œë²Œ JNI ì°¸ì¡°ë¥¼ í•„í„°ë§ í•˜ëŠ” ê¸°ëŠ¥   
+ JNI(Java Native Interface)ëŠ” ìë°” ì½”ë“œ ë° ë„¤ì´í‹°ë¸Œ ì½”ë“œê°€ ì„œë¡œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” í”„ë ˆì„ì›Œí¬   
1) JNI ì°¸ì¡°ëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œì— ì˜í•´ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬ë¨ ë„¤ì´í‹°ë¸Œ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” ìë°” ê°ì²´ê°€ ì˜¤ë«ë™ì•ˆ ì—°ê²°ëœ ìƒíƒœë¡œ ìœ ì§€ë  ìˆ˜ ìˆìŒ   
2) JNI ì°¸ì¡°ê°€ ë¨¼ì € ëª…ì‹œì ìœ¼ë¡œ ì‚­ì œë˜ì§€ ì•Šê³  ì·¨ì†Œë˜ë©´ ìë°” í™ì˜ ì¼ë¶€ ê°ì²´ì— ë„ë‹¬í•˜ì§€ ëª»í•  ìˆ˜ë„ ìˆê³  ê¸€ë¡œë²Œ JNI ì°¸ì¡° í•œë„ë¥¼ ì†Œì§„í•  ìˆ˜ë„ ìˆìŒ   
   
![Alt text](https://github.com/LonerStayle/Development-English-study/blob/main/app/src/main/res/drawable/loner20210718_jni.png)   
 
------------------------------------------
## ì˜ì–´ í•´ì„   
#### Improve app performance while profiling   
í”„ë¡œíŒŒì¼ë§ ë™ì•ˆ ì•± ê°œì„    
   
#### To improve app performance while profiling, the memory profiler samples memory allocations periodically by default.   
í”„ë¡œíŒŒì¼ë§ ë™ì•ˆ ì•± ê°œì„  ìœ„í•´, ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ëŸ¬ëŠ” ë””í´íŠ¸ë¡œ ì£¼ê¸°ì ìœ¼ë¡œ ë©”ëª¨ë¦¬ í• ë‹¹ì„ ìƒ˜í”Œë§ í•©ë‹ˆë‹¤.   
+ sample ì´ ë™ì‚¬ë¡œ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ê°€ ìˆë‹¤ê³  í•¨   
   
#### When testing on devices running API level 26 or higher, you can change this behavior by using the Allocation Tracking dropdown.   
API ë ˆë²¨ 26 í˜¹ì€ ì´ìƒì˜ ê¸°ê¸°ì—ì„œ í…ŒìŠ¤íŠ¸ í•  ë•Œ Allocation Tracking Dropdown ì‚¬ìš©í•´ì„œ ë™ì‘ì„ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.   
+ ì „ì¹˜ì‚¬ ë¹„êµ: atì€ êµ¬ì²´ì ì¸ ê²ƒì„ ëœ» í• ë•Œ , on ì€ at ë³´ë‹¤ í° ë²”ìœ„ë¥¼ ì´ì•¼ê¸°í•¨, inì€ on ë³´ë‹¤ í¼ // ì¦‰ at< on < in   
   
#### The options available are as follows   
ì‚¬ìš© ê°€ëŠ¥í•œ ì˜µì…˜ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  
+as follows ë‹¤ìŒê³¼ ê°™ì´   
   
#### Full: Captures all object allocations in memory.   
ë©”ëª¨ë¦¬ì—ì„œ ëª¨ë“  ê°ì²´ í• ë‹¹ì„ ìº¡ì³í•©ë‹ˆë‹¤.   
   
#### This is the default behavior in Android Studio 3.2 and earlier.   
ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ 3.2 ì´ì „ ë²„ì „ì˜ ê²½ìš° ê¸°ë³¸ì ì¸ ë™ì‘ì…ë‹ˆë‹¤.  
+Android Studio 3.2 ì´í•˜ ë²„ì „ í‘œí˜„ë³´ë‹¤ ëª…ì‹œì ìœ¼ë¡œ Android Studio 3.2 í•´ë‹¹ ë²„ì „ê³¼ ê·¸ ì´ì „ ë²„ì „ì„ ëœ»í•˜ê³  ì‹¶ì—ˆë‚˜ë´„   
   
#### If you have an app that allocates a lot of objects, you might observe visible slowdowns with your app while profiling.   
ë§ì€ ê°ì²´ë¥¼ í• ë‹¹í•œ ì•±ì´ ìˆëŠ” ê²½ìš°, í”„ë¡œíŒŒì¼ë§ ë™ì•ˆ ì•±ì´ ëˆˆì— ë„ê²Œ ì†ë„ ì €í•˜ë¥¼ í•˜ëŠ”ê²ƒì„ ê´€ì°°í•  ìˆ˜ ìˆë‹¤.    
+visible ì€ ì‹¤ì œ ì‚¬ëŒ ëˆˆì— ë³´ì´ëŠ”ì§€ ëœ»í•˜ê¸°ë„ í•¨   
+slowdown ëŠ” ì²œì²œíˆ í•˜ë‹¤ì˜ ìˆ™ì–´ í‘œí˜„   
   
#### Sampled: Samples object allocations in memory at regular intervals.   
Sampled: ì¼ì •í•œ ê°„ê²©ìœ¼ë¡œ ê°ì²´ ë©”ëª¨ë¦¬ í• ë‹¹ì„ ìƒ˜í”Œë§ í•©ë‹ˆë‹¤.  
   
#### This is the default option and has less impact on app performance while profiling.   
ì´ê²ƒì€ ê¸°ë³¸ ì˜µì…˜ì´ê³  í”„ë¡œíŒŒì¼ë§ ë™ì•ˆ ì•± ì„±ëŠ¥ì˜ ì˜í–¥ì´ ì ìŠµë‹ˆë‹¤.   
+í•œêµ­ì‹ìœ¼ë¡œ ë²ˆì—­í•˜ë©´ ì•± ì„±ëŠ¥ì˜ ë¯¸ì¹˜ëŠ” ì˜í–¥ì´ ì ë‹¤. ê°€ ë§ì„ë“¯   
   
#### Apps that allocate a lot of objects over a short span of time may still exhibit visible slowdowns.   
ì§¦ì€ ì‹œê°„ ë™ì•ˆ ë§ì€ ê°ì²´ë¥¼ í• ë‹¹í•œ ì•±ì€ ì—¬ì „íˆ ëˆˆì— ë„ê²Œ ì†ë„ ì €í•˜ë¥¼ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.    
+Apps that allocate a lot of objects over a short span of time -> Apps ë’¤ì— ê¾¸ë¯¸ëŠ” that ì´ë¼ ë’¤ì— ê¾¸ë©°ì„œ Apps ë¥¼ ë§í•´ì•¼í•¨   
+over a ~ ë’¤ì— ì‹œê°„ì´ ë¶™ìœ¼ë©´ ~ë™ì•ˆ , ë‚ ì§œê°€ ë¶™ìœ¼ë©´ ì´ìƒ   
+span í•œêµ­ì—ëŠ” ì—†ëŠ” ë§ì¸ë“¯..?   
   
#### Off: Stops tracking your app's memory allocation.   
ì•±ì˜ ë©”ëª¨ë¦¬ í• ë‹¹ ì¶”ì ì„ ë©ˆì¶¥ë‹ˆë‹¤.   
   
#### Note: By default, Android Studio stops tracking live allocation when performing a CPU recording and   
ê¸°ë³¸ì ìœ¼ë¡œ, Android Studio ëŠ” CPU ê¸°ë¡ í• ë•Œ ì‹¤ì‹œê°„ í• ë‹¹ ì¶”ì ì„ ë©ˆì¶”ê³    
   
#### turns it back on after the CPU recording is done.   
CPU ê¸°ë¡ì´ ì™„ë£Œëœ í›„ì— ë‹¤ì‹œ ì¼­ë‹ˆë‹¤.   
+it back -> ë‹¤ì‹œ   
   
#### View global JNI references   
ì „ì—­ JNI ì°¸ì¡° ë³´ê¸°   
   
#### Java Native Interface (JNI) is a framework that allows Java code and native code to call one another.   
ìë°” ë„¤ì´í‹°ë¸Œ ì¸í„°í˜ì´ìŠ¤ (JNI)ëŠ” ìë°” ì½”ë“œì™€ ë„¤ì´í‹°ë¸Œ ì½”ë“œê°€ ì„œë¡œ í˜¸ì¶œí•˜ë„ë¡ í—ˆìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬ ì…ë‹ˆë‹¤.   
+ A and B to call one another. -> Aì™€ Bê°€ ì„œë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.   
   
#### JNI references are managed manually by the native code   
JNI ì°¸ì¡°ëŠ” ë„¤ì´í‹°ë¸Œ ì½”ë“œì—ì„œ ìˆ˜ë™ìœ¼ë¡œ ê´€ë¦¬ í•©ë‹ˆë‹¤.   
+GCë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì´ì•¼ê¸° ì¼ê¹Œ..   
   
#### so it is possible for Java objects used by native code to be kept alive for too long.   
ë”°ë¼ì„œ ë„¤ì´í‹°ë¸Œ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ëŠ” java ê°ì²´ê°€ ë„ˆë¬´ ì˜¤ë«ë™ì•ˆ í™œì„±ì´ ìœ ì§€ê°€ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.   
   
#### Some objects on the Java heap may become unreachable if a JNI reference is discarded without first being explicitly deleted.   
JNI ì°¸ì¡°ê°€ ë¨¼ì € ëª…ì‹œì ìœ¼ë¡œ ì‚­ì œë˜ì§€ ì•Šê³  ì‚­ì œë˜ë©´ Java í™ì˜ ì¼ë¶€ ê°ì²´ì— ë„ë‹¬í•  ìˆ˜ ì—†ê²Œ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.   
+ í•´ì„í•˜ê¸° ë„ˆë¬´ ì–´ë ¤ì›Œì„œ í•œê¸€ ì°¸ê³ .   
+ unreachable ì˜ ê²½ìš° í”„ë¡œê·¸ë˜ë°ì—ì„œ ê°€ë”ì”© ì“°ëŠ” í‘œí˜„  ex: unreachable code -> ë„ë‹¬ í•  ìˆ˜ ì—†ëŠ” ì½”ë“œ   
   
#### Also, it is possible to exhaust the global JNI reference limit.   
ë˜í•œ, ì „ì—­ JNI ì°¸ì¡°ì˜ ì œí•œì„ ë‹¤ ì¨ë²„ë¦¬ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.   
+ ì—¬ê¸°ì„œ exhaust ëŠ” ë‹¤ì¨ë²„ë¦¬ë‹¤, ê³ ê°ˆë¡œ ì“°ì„   
   
#### To troubleshoot such issues,    
ì´ëŸ¬í•œ ì´ìŠˆë“¤ì„ í•´ê²°í•˜ë ¤ë©´,   
   
#### use the JNI heap view in the Memory Profiler to browse all global JNI references and filter them by Java types and native call stacks.
ë©”ëª¨ë¦¬ í”„ë¡œíŒŒì¼ëŸ¬ì˜ JNI heep ë³´ê¸°ë¥¼ ì‚¬ìš©í•´ì„œ ëª¨ë“  ì „ì—­ JNI ì°¸ì¡°ë¥¼ ê²€ìƒ‰í•˜ê±°ë‚˜ java types í˜¹ì€ native call stacks ë³„ë¡œ í•„í„°ë§ í•©ë‹ˆë‹¤.   
+filter ê°€ ë™ì‚¬ë¡œ ì“°ì„   
   
#### With this information, you can find when and where global JNI references are created and deleted.   
ì´ ì •ë³´ë¥¼ ê°€ì§€ê³ , ì „ì—­ JNI ì°¸ì¡°ë¥¼ ìƒì„± ë° ì‚­ì œ ì‹œê¸°ì™€ ìœ„ì¹˜ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤. 
+With this ê°€ ì•ì˜ ë¬¸ì¥ê³¼ ì´ì–´ì£¼ëŠ” ì—­í™œì„ í•´ì¤Œ   
+when and where ëŠ” ë’¤ì— ë¬¸ì¥ì´ ì—†ìœ¼ë©´ ì–¸ì œ ì–´ë””ì„œ ë¼ëŠ” ëœ»ì´ ë˜ëŠ”ë° í˜ì´í¬ì— ê±¸ë¦¬ì§€ ë§ì.   
+find ë•Œë¬¸ì— ì°¾ì„ ìˆ˜ ìˆë‹¤ë¡œ ë°”ë€œ   
   
#### While your app is running,   
ì•±ì´ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ, 

#### select a portion of the timeline that you want to inspect and select JNI heap from the drop-down menu above the class list.  
ê²€ì‚¬í•  íƒ€ì„ë¼ì¸ ë¶€ë¶„ì„ ì„ íƒí•˜ê³  í´ë˜ìŠ¤ ëª©ë¡ ìœ„ì˜ drop down menu ì—ì„œ JNI heep ì„ ì„ íƒí•©ë‹ˆë‹¤.   
+ ~that you want to inspect that ìœ¼ë¡œ ì¸í•´ ì•ì— ë¶€ë¶„ì„ ê¾¸ë©°ì¤Œ   
+ A above B -> B ìœ„ì˜ A   
   
#### You can then inspect objects in the heap as you normally would and   
ê·¸ëŸ° ë‹¤ìŒ í‰ì†Œì™€ ê°™ì´ í™ì˜ ê°ì²´ë¥¼ ê²€ì‚¬ í•  ìˆ˜ ìˆìœ¼ë©°
+ as you normally would ì¼ë°˜ì ìœ¼ë¡œ   
   
#### double-click objects in the Allocation Call Stack tab to see where the JNI references are allocated and released in your code,   
Allocation Call Stack íƒ­ì—ì„œ ê°ì²´ë¥¼ ë”ë¸” í´ë¦­í•´ì„œ ì½”ë“œì—ì„œ JNI ë ˆí¼ëŸ°ìŠ¤ë¥¼ í• ë‹¹ í–ˆê±°ë‚˜ í•´ì œë˜ëŠ” ìœ„ì¹˜ë¥¼ ì°¸ì¡°í• ìˆ˜ ìˆìŠµë‹ˆë‹¤.   
   
#### as shown in figure 4.   
ê·¸ë¦¼ 4ì™€ ê°™ì´.
   
#### To inspect memory allocations for your appâ€™s JNI code, you must deploy your app to a device running Android 8.0 or higher.   
ì•±ì˜ JNI code ì— ëŒ€í•œ ë©”ëª¨ë¦¬ í• ë‹¹ ê²€ì‚¬ë¥¼ í•˜ë ¤ë©´, ì•ˆë“œë¡œì´ë“œ 8.0 í˜¹ì€ ê·¸ ì´ìƒì„ ì‹¤í–‰í•˜ëŠ” ê¸°ê¸°ì— ì•±ì„ ë°°í¬í•´ì•¼ë§Œ í•©ë‹ˆë‹¤.   
   
#### For more information on JNI, see JNI tips.   
JNIì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ , JNI tips ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”   
+ For more information -> ìì„¸í•œ ë‚´ìš©ì€   
   
-----------------------------------

## ğŸ“— ë‹¨ì–´ ì •ë¦¬ ğŸ“˜   
   
|ì˜ì–´|í•œê¸€|
|---|---|
|periodically|ì£¼ê¸°ì ìœ¼ë¡œ|   
|earlier|ì¼ì°,ì¢€ì „ì—|   
|a lot of|ë§ì€|  
|regular intervals|ì¼ì •í•œ ê°„ê²©|   
|impact on|~ì— ì˜í–¥|   
|less|ì ìŒ|
|spen|ìŠ¤íŒ¬(í•œêµ­ì—ëŠ” ì—†ëŠ”ë§ ì¸ë“¯ ìƒí™©ì— ë”°ë¼ ë‚ ê°œ,ê¸°ê°„,ë¼˜,ì•„ì£¼ ìƒˆë¡œìš´,ì±„ìš°ë‹¤ ë“±ë“±)|
|performing|ì‹¤í–‰í•  ìˆ˜ ìˆëŠ”|
|one another|ì„œë¡œ|
|manually|ìˆ˜ë™|    
|discarded|ë²„ë ¤ì§„|
|unreachable|ë„ë‹¬í•  ìˆ˜ ì—†ëŠ”|
|exhaust|(http://dic.impact.pe.kr/ecmaster-cgi/search.cgi?kwd=exhaust)|
|troubleshoot|ë¬¸ì œí•´ê²°|
|browse|ê²€ìƒ‰|
|deploy|ë°°í¬|
