### Use coroutines for main-safety

We consider a function main-safe when it doesn't block UI updates on the main thread.
The makeLoginRequest function is not main-safe, as calling makeLoginRequest from the main thread does block the UI.
Use the withContext() function from the coroutines library to move the execution of a coroutine to a different thread:

ìš°ë¦¬ëŠ” ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ uiì—…ë°ì´íŠ¸ê°€ ì°¨ë‹¨ë˜ì§€ ì•Š í•¨ìˆ˜ë¥¼ ë©”ì¸ ì„¸ì´í”„ í•¨ìˆ˜ë¼ê³  ê°„ì£¼í•œë‹¤.
{itì€ functionì„ ê°€ë¦¬í‚¤ê³  ì—¬ê¸°ì„œ considerì€ aë¥¼ bë¼ê³  ê°„ì£¼í•œë‹¤.}

class LoginRepository(...) {
    ...
    suspend fun makeLoginRequest(
        jsonBody: String
    ): Result<LoginResponse> {

        // Move the execution of the coroutine to the I/O dispatcher
        return withContext(Dispatchers.IO) {
            // Blocking network request code
        }
    }
}

withContext(Dispatchers.IO) moves the execution of the coroutine to an I/O thread, making our calling function main-safe and enabling the UI to update as needed.
makeLoginRequest is also marked with the suspend keyword. This keyword is Kotlin's way to enforce a function to be called from within a coroutine.

withContext í•¨ìˆ˜ëŠ” i/oìŠ¤ë ˆë“œë¡œ ë©”ì¸ì„¸ì´í”„ í•¨ìˆ˜ì™€ ê°€ëŠ¥í•œ ui ì—…ë°ì´íŠ¸ë¥¼ ìƒì„±í•˜ë©´ì„œ ì½”ë£¨í‹´ ì‹¤í–‰ì„ ì´ë™ì‹œí‚¨ë‹¤
makeLoginRequestë„ suspend í‚¤ì›Œë“œê°€ ë¶™ì—¬ìˆë‹¤. í•´ë‹¹ í‚¤ì›Œë“œëŠ” ì½”ë£¨í‹´ ë‚´ë¶€ì—ì„œ í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë„ë¡ ê°•ì œí•˜ëŠ” ë°©ë²•ì´ë‹¤.

In the following example, the coroutine is created in the LoginViewModel. As makeLoginRequest moves the execution off the main thread,
the coroutine in the login function can be now executed in the main thread:

ì˜ˆì œì—ì„œ ì½”ë£¨í‹´ì€ LoginViewModelì—ì„œ ìƒì„±ë˜ì—ˆë‹¤. makeLoginRequestê°€ ë©”ìŠ¤ë ˆë“œ ë°–ì˜ ì‹¤í–‰ìœ¼ë¡œ ì´ë™í•˜ë¯€ë¡œ, ë¡œê·¸ì¸ í•¨ìˆ˜ì—ì„œ ì½”ë£¨í‹´ì€ ì´ì œ ë©”ì¸ìŠ¤ë ˆë“œ ì•ˆì—ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆë‹¤.

class LoginViewModel(
    private val loginRepository: LoginRepository
): ViewModel() {

    fun login(username: String, token: String) {

        // Create a new coroutine on the UI thread
        viewModelScope.launch {
            val jsonBody = "{ username: \"$username\", token: \"$token\"}"

            // Make the network call and suspend execution until it finishes
            val result = loginRepository.makeLoginRequest(jsonBody)

            // Display result of the network request to the user
            when (result) {
                is Result.Success<LoginResponse> -> // Happy path
                else -> // Show error in UI
            }
        }
    }
}

Note that the coroutine is still needed here, since makeLoginRequest is a suspend function,
and all suspend functions must be executed in a coroutine.
This code differs from the previous login example in a couple of ways:

makeLoginRequest í•¨ìˆ˜ê°€ ì„œìŠ¤íœë“œ í•¨ìˆ˜ì´ê¸°ë•Œë¬¸ì— ì½”ë£¨í‹´ì€ ì—¬ì „íˆ ì—¬ê¸°ì— í•„ìš”í•˜ë©° ëª¨ë“  ì„œìŠ¤íœë“œ í•¨ìˆ˜ëŠ” ì½”ë£¨í‹´ ë‚´ì—ì„œ ì‹¤í–‰ë˜ì–´ì•¼í•œë‹¤.
í•´ë‹¹ ì½”ë“œëŠ” ì´ì „ ë¡œê·¸ì¸ ì˜ˆì œì™€ ëª‡ëª‡ ì°¨ì´ê°€ ìˆë‹¤.

- launch doesn't take a Dispatchers.IO parameter. When you don't pass a Dispatcher to launch, any coroutines launched from viewModelScope run in the main thread.

ëŸ°ì²˜ëŠ” ë””ìŠ¤íŒ¨ì³ ioíŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŸ°ì²˜ë¡œ ë””ìŠ¤íŒ¨ì²˜ë¥¼ ì „ë‹¬í•˜ì§€ ì•Šì„ ë•Œ ë·°ëª¨ë¸ ìŠ¤ì½”í”„ì—ì„œ ì‹¤í–‰ëœ ì½”ë£¨í‹´ë“¤ì€ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ëœë‹¤.

- The result of the network request is now handled to display the success or failure UI.

ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ê²°ê³¼ëŠ” ì„±ê³µ í˜¹ì€ ì‹¤íŒ¨ uië¥¼ í‘œì‹œí•˜ë„ë¡ ì²˜ë¦¬ëœë‹¤.

The login function now executes as follows:

- The app calls the login() function from the View layer on the main thread.

ì•±ì€ ë¡œê·¸ì¸ í•¨ìˆ˜ë¥¼ ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ë·° ë ˆì´ì•„ì›ƒë¡œë¶€í„° í˜¸ì¶œí•œë‹¤.

- launch creates a new coroutine to make the network request on the main thread, and the coroutine begins execution.

ëŸ°ì²˜ëŠ” ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ë„¤íŠ¸ì›Œí¬ ìš”ì²˜ì„ ë§Œë“¤ê¸° ìœ„í•´ ìƒˆë¡œìš´ ì½”ë£¨í‹´ì„ ìƒì„±í•œë‹¤ ê·¸ë¦¬ê³  ì½”ë£¨í‹´ì€ ì‹¤í–‰ì„ ì‹œì‘í•œë‹¤.

- Within the coroutine, the call to loginRepository.makeLoginRequest() now suspends further execution
of the coroutine until the withContext block in makeLoginRequest() finishes running.

ì½”ë£¨í‹´ ë‚´ë¶€ì—ì„œ loginRepository.makeLoginRequest()í•¨ìˆ˜ í˜¸ì¶œì€ makeLoginRequest() í•¨ìˆ˜ ì‹¤í–‰ì´ ëë‚ ë•Œê¹Œì§€ ì¶”ê°€ ì‹¤í–‰ì„ ì •ì§€í•œë‹¤.

- Once the withContext block finishes, the coroutine in login() resumes execution on the main thread with
the result of the network request.

withContext ë¸”ë¡ì´ ì™„ë£Œë˜ë©´ ë¡œê·¸ì¸ í•¨ìˆ˜ì— ìˆëŠ” ì½”ë£¨í‹´ì€ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì˜ ê²°ê³¼ì™€ ë©”ì¸ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ì„ ì¬ê°œí•œë‹¤.

â˜… Note: To communicate with the View from the ViewModel layer, use LiveData as recommended in the Guide to app architecture. When following this pattern, the code in the ViewModel is executed on the main thread, so you can call MutableLiveData's setValue() function directly.
ë·°ëª¨ë¸ ë ˆì´ì–´ë¡œë¶€í„° ë·°ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ì„œëŠ” ë¼ì´ë¸Œ ë°ì´í„° ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤.

### Handling exceptions

To handle exceptions that the Repository layer can throw, use Kotlin's built-in support for exceptions.
In the following example, we use a try-catch block:

ì €ì¥ì†Œ ë ˆì´ì–´ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì˜ˆì™¸ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•´ì„œ ì½”ë£¨í‹´ì—ì„œ ìì²´ ì§€ì›í•˜ëŠ” ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•œë‹¤.

class LoginViewModel(
    private val loginRepository: LoginRepository
): ViewModel() {

    fun makeLoginRequest(username: String, token: String) {
        viewModelScope.launch {
            val jsonBody = "{ username: \"$username\", token: \"$token\"}"
            val result = try {
                loginRepository.makeLoginRequest(jsonBody)
            } catch(e: Exception) {
                Result.Error(Exception("Network request failed"))
            }
            when (result) {
                is Result.Success<LoginResponse> -> // Happy path
                else -> // Show error in UI
            }
        }
    }
}

In this example, any unexpected exception thrown by the makeLoginRequest() call is handled as an error in the UI.
í•´ë‹¹ ì˜ˆì œì—ì„œ makeLoginRequest() í•¨ìˆ˜ í˜¸ì¶œì— ì˜í•´ ë°œìƒë˜ëŠ” ì˜ˆì™¸ìƒí™©ì€ uiì—ì„œ ì—ëŸ¬ë¡œì„œ ì²˜ë¦¬ëœë‹¤.
---------------------------------------------------------------------------
## ğŸ“— ë‹¨ì–´ ì •ë¦¬ ğŸ“˜   
   
|ì˜ì–´|í•œê¸€|
|---|---|
|consider|ê°„ì£¼í•˜ë‹¤|
